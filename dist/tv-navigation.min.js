!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).TVNavigation=t()}(this,(function(){"use strict";var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var t=new(function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}return e(t,[{key:"chebyshevDistance",value:function(e,t,n,r,o){var i=-r,u=void 0;for(u=0;u<n;u+=1)i=o(i,Math.abs(e[u]-t[u]));return i}},{key:"minkowskiDistance",value:function(e,t,n,r,o){var i=void 0,u=void 0;if(t!==r)throw new Error("Both vectors should have same dimension");if(isNaN(o))throw new Error('The order "p" must be a number');if(o===Number.POSITIVE_INFINITY)return this.chebyshevDistance(e,n,t,o,Math.max);if(o===Number.NEGATIVE_INFINITY)return this.chebyshevDistance(e,n,t,o,Math.min);if(o<1)throw new Error("Order less than 1 will violate the triangle inequality");for(i=0,u=0;u<t;u+=1)i+=Math.pow(Math.abs(e[u]-n[u]),o);return isNaN(i)?0:Math.pow(i,1/o)}},{key:"calculate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return this.minkowskiDistance(e,e.length,t,t.length,n)}}]),t}()),n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={selector:"",straightOnly:!1,straightOverlapThreshold:.35,rememberSource:!1,disabled:!1,defaultElement:"",enterTo:"",leaveFor:null,restrict:"self-first",tabIndexIgnoreList:[],navigableFilter:null},i={4:"left",21:"left",37:"left",214:"left",205:"left",218:"left",5:"right",22:"right",39:"right",213:"right",206:"right",217:"right",29460:"up",19:"up",38:"up",211:"up",203:"up",215:"up",29461:"down",20:"down",40:"down",212:"down",204:"down",216:"down",29443:"enter",13:"enter",67:"enter",32:"enter",23:"enter",195:"enter"},u={left:"right",up:"down",right:"left",down:"up"},a=0,c=!1,s=!1,f={},l=0,d="",v="",h=!1,y=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(e){var t=(this.parentNode||this.document).querySelectorAll(e);return[].slice.call(t).indexOf(this)>=0},p=function(e){var t=e.getBoundingClientRect(),n={left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height};return n.element=e,n.center={x:n.left+Math.floor(n.width/2),y:n.top+Math.floor(n.height/2)},n.center.left=n.center.x,n.center.right=n.center.x,n.center.top=n.center.y,n.center.bottom=n.center.y,n},m=function(e,n,r,o){if(!(e&&n&&r&&r.length))return null;var i=p(e);if(!i)return null;var u=[];if(r.forEach((function(e){var t=p(e);t&&u.push(t)})),!u.length)return null;var a,c=(a=i,{nearestIsBetter:function(e){var n=[a.center.x,a.center.y];return t.calculate(n,[e.center.x,e.center.y])},nearPlumbLineIsBetter:function(e){var t=void 0;return(t=e.center.x<a.center.x?a.center.x-e.right:e.left-a.center.x)<0?0:t},nearHorizonIsBetter:function(e){var t=void 0;return(t=e.center.y<a.center.y?a.center.y-e.bottom:e.top-a.center.y)<0?0:t},nearTargetLeftIsBetter:function(e){var t=void 0;return(t=e.center.x<a.center.x?a.left-e.right:e.left-a.left)<0?0:t},nearTargetTopIsBetter:function(e){var t=void 0;return(t=e.center.y<a.center.y?a.top-e.bottom:e.top-a.top)<0?0:t},topIsBetter:function(e){return e.top},bottomIsBetter:function(e){return-1*e.bottom},leftIsBetter:function(e){return e.left},rightIsBetter:function(e){return-1*e.right}}),s=void 0;switch(n){case"left":s=[{group:u=u.filter((function(e){return e.center.x<i.center.x})),distance:[c.nearHorizonIsBetter,c.nearestIsBetter,c.topIsBetter]}];break;case"right":s=[{group:u=u.filter((function(e){return e.center.x>i.center.x})),distance:[c.nearHorizonIsBetter,c.nearestIsBetter,c.topIsBetter]}];break;case"up":s=[{group:u=u.filter((function(e){return e.center.y<i.center.y})),distance:[c.nearestIsBetter,c.nearHorizonIsBetter,c.leftIsBetter]}];break;case"down":s=[{group:u=u.filter((function(e){return e.center.y>i.center.y})),distance:[c.nearestIsBetter,c.nearPlumbLineIsBetter,c.topIsBetter,c.nearTargetLeftIsBetter]}];break;default:return null}o.straightOnly&&s.pop();var f=function(e){for(var t=void 0,n=0;n<e.length;n++)if(e[n].group.length){t=e[n];break}if(!t)return null;var r=t.distance;return t.group.sort((function(e,t){for(var n=0;n<r.length;n++){var o=r[n],i=o(e)-o(t);if(i)return i}return 0})),t.group}(s);if(!f)return null;var l=void 0;if(o.rememberSource&&o.previous&&o.previous.destination===e&&o.previous.reverse===n)for(var d in f)if(d.element===o.previous.target){l=d.element;break}return l||(l=f[0].element),l},b=function(){var e=void 0;do{e="section-"+String(++a)}while(f[e]);return e},g=function(e){return"string"==typeof e?[].slice.call(document.querySelectorAll(e)):"object"===(void 0===e?"undefined":r(e))&&e.length?[].slice.call(e):"object"===(void 0===e?"undefined":r(e))&&1===e.nodeType?[e]:[]},w=function(e,t){return"string"==typeof t?y.call(e,t):"object"===(void 0===t?"undefined":r(t))&&t.length?t.indexOf(e)>=0:"object"===(void 0===t?"undefined":r(t))&&1===t.nodeType&&e===t},E=function(){var e=document.activeElement;if(e&&e!==document.body)return e},I=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var o=e||{},i=1;i<n.length;i++)if(n[i])for(var u in n[i])Object.prototype.hasOwnProperty.call(n[i],u)&&void 0!==n[i][u]&&(o[u]=n[i][u]);return o},x=function(e,t){for(var n in Array.from(t)){var r=e.indexOf(n);r>=0&&e.splice(r,1)}return e},L=function(e,t,n){if(!e||!t||!f[t]||f[t].disabled)return!1;if(e.offsetWidth<=0&&e.offsetHeight<=0||e.hasAttribute("disabled"))return!1;if(n&&!w(e,f[t].selector))return!1;if("function"==typeof f[t].navigableFilter){if(!1===f[t].navigableFilter(e,t))return!1}else if("function"==typeof o.navigableFilter&&!1===o.navigableFilter(e,t))return!1;return!0},S=function(e){for(var t in f)if(!f[t].disabled&&e&&w(e,f[t].selector))return t},F=function(e){return g(f[e].selector).filter((function(t){return L(t,e)}))},k=function(e){var t=f[e].defaultElement;if(!t)return null;if("string"==typeof t){var r=g(t);t=n(r,1)[0]}return L(t,e,!0)?t:null},B=function(e){var t=f[e]&&f[e].lastFocusedElement;return L(t,e,!0)?t:null},T=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=document.createEvent("CustomEvent");return o.initCustomEvent("sn:"+t,!0,r,n),e.dispatchEvent(o)},A=function(e,t){var n=t||S(e);n&&(f[n].lastFocusedElement=e,v=n)},N=function(e,t,n){if(!e)return!1;var r=E(),o=function(){r&&r.blur(),e.focus(),A(e,t)};if(h)return o(),!0;if(h=!0,s)return o(),h=!1,!0;if(r){var i={nextElement:e,nextSectionId:t,direction:n,native:!1};if(!T(r,"willunfocus",i))return h=!1,!1;r.blur(),T(r,"unfocused",i,!1)}var u={previousElement:r,sectionId:t,direction:n,native:!1};return T(e,"willfocus",u)?(e.focus(),T(e,"focused",u,!1),h=!1,A(e,t),!0):(h=!1,!1)},O=function(e){var t=[],n=function(e){e&&t.indexOf(e)<0&&f[e]&&!f[e].disabled&&t.push(e)};e?n(e):(n(d),n(v),Object.keys(f).map(n));for(var r=0;r<t.length;r++){var o=t[r],i=void 0;if(i="last-focused"===f[o].enterTo?B(o)||k(o)||F(o)[0]:k(o)||B(o)||F(o)[0])return N(i,o)}return!1},P=function(e,t){if("@"===e.charAt(0)){if(1===e.length)return O();var r=e.substr(1);return O(r)}var o=g(e),i=n(o,1)[0];if(i){var u=S(i);if(L(i,u))return N(i,u,t)}return!1},j=function(e,t){return T(e,"navigatefailed",{direction:t},!1)},M=function(e,t){if(f[e].leaveFor&&void 0!==f[e].leaveFor[t]){var n=f[e].leaveFor[t];if("string"==typeof n)return""===n?null:P(n,t);var r=S(n);if(L(n,r))return N(n,r,t)}return!1},C=function(e,t,n){var r=t.getAttribute("data-sn-"+e);if("string"==typeof r)return!(""===r||!P(r,e))||(j(t,e),!1);var i={},a=[];for(var c in f)i[c]=F(c),a=a.concat(i[c]);var s=I({},o,f[n]),l=void 0,d=void 0;if("self-only"===s.restrict||"self-first"===s.restrict){var v=i[n];d=x(v,t),(l=m(t,e,d,s))||"self-first"!==s.restrict||(d=x(a,v),l=m(t,e,d,s))}else d=x(a,t),l=m(t,e,d,s);if(l){f[n].previous={target:t,destination:l,reverse:u[e]};var h=S(l);if(n!==h){var y=M(n,e);if(y)return!0;if(null===y)return j(t,e),!1;var p=void 0;switch(f[h].enterTo){case"last-focused":p=B(h)||k(h);break;case"default-element":p=k(h)}p&&(l=p)}return N(l,h,e)}return!!M(n,e)||(j(t,e),!1)},K=function(e){return e.preventDefault(),e.stopPropagation(),!1},D=function(e){var t=e.target;if(t&&(t.classList.contains("focusable")||t.closest(".focusable"))){var n=t.classList.contains("focusable")?t:t.closest(".focusable");return N(n,S(n)),K(e)}},q=function(e){var t=e.target;if(t&&(t.classList.contains("focusable")||t.closest(".focusable"))){var n=t.classList.contains("focusable")?t:t.closest(".focusable");return T(n,"enter-down")?void 0:K(e)}},z=function(e){if(!(!l||s||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var t=E(),n=S(t),r=i[e.keyCode];if(r){if("enter"===r&&t&&n&&!T(t,"enter-down"))return K(e);if(!t&&(v&&(t=B(v)),!t))return O(),K(e);if(n)return T(t,"willmove",{direction:r,sectionId:n,cause:"keydown"})&&C(r,t,n),K(e)}}},H=function(e){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)&&!s&&l&&"center"===i[e.keyCode]){var t=E();t&&S(t)&&(T(t,"enter-up")||K(e))}},V=function(e){var t=e.target;if(t!==window&&t!==document&&l&&!h){var n=S(t);if(n){if(s)return void A(t,n);var r={sectionId:n,native:!0};T(t,"willfocus",r)?(T(t,"focused",r,!1),A(t,n)):(h=!0,t.blur(),h=!1)}}},Y=function(e){var t=e.target;if(t!==window&&t!==document&&!s&&l&&!h&&S(t)){var n={native:!0};T(t,"willunfocus",n)?T(t,"unfocused",n,!1):(h=!0,setTimeout((function(){t.focus(),h=!1})))}},_={init:function(){c||(window.addEventListener("mouseover",D),window.addEventListener("mousedown",q),window.addEventListener("keydown",z),window.addEventListener("keyup",H),window.addEventListener("focus",V,!0),window.addEventListener("blur",Y,!0),c=!0)},uninit:function(){window.removeEventListener("mouseover",D),window.removeEventListener("mousedown",q),window.removeEventListener("blur",Y,!0),window.removeEventListener("focus",V,!0),window.removeEventListener("keyup",H),window.removeEventListener("keydown",z),_.clear(),a=0,c=!1},clear:function(){f={},l=0,d="",v="",h=!1},set:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=void 0,u=void 0;if("object"===r(t[0]))u=t[0];else{if("string"!=typeof t[0]||"object"!==r(t[1]))return;if(i=t[0],u=t[1],!f[i])throw new Error("Section "+i+" doesn't exist!")}for(var a in u)void 0!==o[a]&&(i?f[i][a]=u[a]:void 0!==u[a]&&(o[a]=u[a]))},add:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=void 0,i=void 0;if("object"===r(t[0])?i=t[0]:"string"==typeof t[0]&&"object"===r(t[1])&&(o=t[0],i=t[1]),o||(o="string"==typeof i.id?i.id:b()),f[o])throw new Error("Section "+o+" has already existed!");return f[o]={},l++,_.set(o,i),o},remove:function(e){if(!e||"string"!=typeof e)throw new Error('Please assign the "sectionId"!');return!!f[e]&&(f[e]=void 0,f=I({},f),l--,!0)},disable:function(e){return!!f[e]&&(f[e].disabled=!0,!0)},enable:function(e){return!!f[e]&&(f[e].disabled=!1,!0)},pause:function(){s=!0},resume:function(){s=!1},focus:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=t[1];"boolean"==typeof r&&void 0===o&&(o=r,r=void 0);var i=!s&&o;i&&_.pause();var u=void 0;if(r)if("string"==typeof r)u=f[r]?O(r):P(r);else{var a=S(r);L(r,a)&&(u=N(r,a))}else u=O();return i&&_.resume(),u},move:function(e,t){var n=e.toLowerCase();if(!u[n])return!1;var r=t?g(t)[0]:E();if(!r)return!1;var o=S(r);return!!o&&(!!T(r,"willmove",{direction:n,sectionId:o,cause:"api"})&&C(n,r,o))},makeFocusable:function(e){var t=function(e){var t=e.tabIndexIgnoreList||o.tabIndexIgnoreList;g(e.selector).forEach((function(e){w(e,t)||e.getAttribute("tabindex")||e.setAttribute("tabindex","-1")}))};if(e){if(!f[e])throw new Error("Section "+e+" doesn't exist!");t(f[e])}else for(var n in f)t(f[n])},setDefaultSection:function(e){if(e){if(!f[e])throw new Error("Section "+e+" doesn't exist!");d=e}else d=""},getSectionId:S};return{TVNavigation:new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init=function(){_.init(),_.focus(),t.bindFocusEvent()},this.destroy=function(){t.focusedPath=null,_.uninit(),t.unbindFocusEvent()},this.bindFocusEvent=function(){t.listening||(t.listening=!0,document.addEventListener("sn:focused",t.handleFocused))},this.unbindFocusEvent=function(){document.removeEventListener("sn:focused",t.handleFocused),t.listening=!1},this.handleFocused=function(e){t.focusedPath!==e.detail.sectionId&&t.setCurrentFocusedPath(e.detail.sectionId)},this.getCurrentFocusedPath=function(){return t.focusedPath},this.setCurrentFocusedPath=function(e){t.focusedPath=e,_.focus(e)},this.addEventListener=function(e,n,r){return document.querySelectorAll(e).forEach((function(e){return e.addEventListener(n,r)})),t},this.addFocusable=function(e,n){if(e&&!_.getSectionId(document.getElementById(e.id))){t.removeFocusable(e);var r=_.add(e);n&&t.addEventListener(e.selector,"sn:enter-down",n),_.makeFocusable(r)}},this.removeFocusable=function(e){var t=_.getSectionId(document.getElementById(e.id));t&&(_.remove(t),document.querySelectorAll(e.selector).removeEventListener("sn:enter-down"))},this.destroy()}}}));
