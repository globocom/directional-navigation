!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.TVNavigation={})}(this,function(e){"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t(e,[{key:"chebyshevDistance",value:function(e,t,n,r,o){var i=-r,u=void 0;for(u=0;u<n;u+=1)i=o(i,Math.abs(e[u]-t[u]));return i}},{key:"minkowskiDistance",value:function(e,t,n,r,o){var i=void 0,u=void 0;if(t!==r)throw new Error("Both vectors should have same dimension");if(isNaN(o))throw new Error('The order "p" must be a number');if(o===Number.POSITIVE_INFINITY)return this.chebyshevDistance(e,n,t,o,Math.max);if(o===Number.NEGATIVE_INFINITY)return this.chebyshevDistance(e,n,t,o,Math.min);if(o<1)throw new Error("Order less than 1 will violate the triangle inequality");for(i=0,u=0;u<t;u+=1)i+=Math.pow(Math.abs(e[u]-n[u]),o);return isNaN(i)?0:Math.pow(i,1/o)}},{key:"calculate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return this.minkowskiDistance(e,e.length,t,t.length,n)}}]),e}()),r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i={selector:"",straightOnly:!1,straightOverlapThreshold:.35,rememberSource:!1,disabled:!1,defaultElement:"",enterTo:"",leaveFor:null,restrict:"self-first",tabIndexIgnoreList:[],navigableFilter:null},u={4:"left",21:"left",37:"left",214:"left",205:"left",218:"left",5:"right",22:"right",39:"right",213:"right",206:"right",217:"right",29460:"up",19:"up",38:"up",211:"up",203:"up",215:"up",29461:"down",20:"down",40:"down",212:"down",204:"down",216:"down",29443:"enter",13:"enter",67:"enter",32:"enter",23:"enter",195:"enter"},a={left:"right",up:"down",right:"left",down:"up"},c=0,s=!1,f=!1,l={},d=0,v="",h="",y=!1,p=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(e){var t=(this.parentNode||this.document).querySelectorAll(e);return[].slice.call(t).indexOf(this)>=0},b=function(e){var t=e.getBoundingClientRect(),n={left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height};return n.element=e,n.center={x:n.left+Math.floor(n.width/2),y:n.top+Math.floor(n.height/2)},n.center.left=n.center.x,n.center.right=n.center.x,n.center.top=n.center.y,n.center.bottom=n.center.y,n},m=function(e,t,r,o){if(!(e&&t&&r&&r.length))return null;var i=b(e);if(!i)return null;var u=[];if(r.forEach(function(e){var t=b(e);t&&u.push(t)}),!u.length)return null;var a=function(e){return{nearestIsBetter:function(t){var r=[e.center.x,e.center.y],o=n.calculate(r,[t.center.x,t.center.y]);return o<0?0:o},nearPlumbLineIsBetter:function(t){var n=void 0;return(n=t.center.x<e.center.x?e.center.x-t.right:t.left-e.center.x)<0?0:n},nearHorizonIsBetter:function(t){var n=void 0;return(n=t.center.y<e.center.y?e.center.y-t.bottom:t.top-e.center.y)<0?0:n},nearTargetLeftIsBetter:function(t){var n=void 0;return(n=t.center.x<e.center.x?e.left-t.right:t.left-e.left)<0?0:n},nearTargetTopIsBetter:function(t){var n=void 0;return(n=t.center.y<e.center.y?e.top-t.bottom:t.top-e.top)<0?0:n},topIsBetter:function(e){return e.top},bottomIsBetter:function(e){return-1*e.bottom},leftIsBetter:function(e){return e.left},rightIsBetter:function(e){return-1*e.right}}}(i),c=void 0;switch(t){case"left":c=[{group:u=u.filter(function(e){return e.center.x<i.center.x}),distance:[a.nearestIsBetter]},{group:u,distance:[a.nearestIsBetter]}];break;case"right":c=[{group:u=u.filter(function(e){return e.center.x>i.center.x}),distance:[a.nearestIsBetter]},{group:u,distance:[a.nearestIsBetter]}];break;case"up":c=[{group:u=u.filter(function(e){return e.center.y<i.center.y}),distance:[a.nearestIsBetter]},{group:u,distance:[a.nearestIsBetter]}];break;case"down":c=[{group:u=u.filter(function(e){return e.center.y>i.center.y}),distance:[a.nearestIsBetter]}];break;default:return null}o.straightOnly&&c.pop();var s=function(e){for(var t=void 0,n=0;n<e.length;n++)if(e[n].group.length){t=e[n];break}return t?(t.group.sort(function(e,n){return t.distance.forEach(function(t){var r=t(e)-t(n);if(r)return r}),0}),t.group):null}(c);if(!s)return null;var f=void 0;if(o.rememberSource&&o.previous&&o.previous.destination===e&&o.previous.reverse===t)for(var l in s)if(l.element===o.previous.target){f=l.element;break}return f||(f=s[0].element),f},g=function(e){return"string"==typeof e?[].slice.call(document.querySelectorAll(e)):"object"===(void 0===e?"undefined":o(e))&&e.length?[].slice.call(e):"object"===(void 0===e?"undefined":o(e))&&1===e.nodeType?[e]:[]},w=function(e,t){return"string"==typeof t?p.call(e,t):"object"===(void 0===t?"undefined":o(t))&&t.length?t.indexOf(e)>=0:"object"===(void 0===t?"undefined":o(t))&&1===t.nodeType&&e===t},E=function(){var e=document.activeElement;if(e&&e!==document.body)return e},I=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var o=e||{},i=1;i<n.length;i++)if(n[i])for(var u in n[i])Object.prototype.hasOwnProperty.call(n[i],u)&&void 0!==n[i][u]&&(o[u]=n[i][u]);return o},x=function(e,t){for(var n in Array.from(t)){var r=e.indexOf(n);r>=0&&e.splice(r,1)}return e},S=function(e,t,n){if(!e||!t||!l[t]||l[t].disabled)return!1;if(e.offsetWidth<=0&&e.offsetHeight<=0||e.hasAttribute("disabled"))return!1;if(n&&!w(e,l[t].selector))return!1;if("function"==typeof l[t].navigableFilter){if(!1===l[t].navigableFilter(e,t))return!1}else if("function"==typeof i.navigableFilter&&!1===i.navigableFilter(e,t))return!1;return!0},F=function(e){for(var t in l)if(!l[t].disabled&&e&&w(e,l[t].selector))return t},L=function(e){return g(l[e].selector).filter(function(t){return S(t,e)})},k=function(e){var t=l[e].defaultElement;if(!t)return null;if("string"==typeof t){var n=g(t);t=r(n,1)[0]}return S(t,e,!0)?t:null},B=function(e){var t=l[e]&&l[e].lastFocusedElement;return S(t,e,!0)?t:null},T=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=document.createEvent("CustomEvent");return o.initCustomEvent("sn:"+t,!0,r,n),e.dispatchEvent(o)},A=function(e,t){var n=t||F(e);n&&(l[n].lastFocusedElement=e,h=n)},O=function(e,t,n){if(!e)return!1;var r=E(),o=function(){r&&r.blur(),e.focus(),A(e,t)};if(y)return o(),!0;if(y=!0,f)return o(),y=!1,!0;if(r){var i={nextElement:e,nextSectionId:t,direction:n,native:!1};if(!T(r,"willunfocus",i))return y=!1,!1;r.blur(),T(r,"unfocused",i,!1)}var u={previousElement:r,sectionId:t,direction:n,native:!1};return T(e,"willfocus",u)?(e.focus(),T(e,"focused",u,!1),y=!1,A(e,t),!0):(y=!1,!1)},j=function(e){var t=[],n=function(e){e&&t.indexOf(e)<0&&l[e]&&!l[e].disabled&&t.push(e)};e?n(e):(n(v),n(h),Object.keys(l).map(n));for(var r=0;r<t.length;r++){var o=t[r],i=void 0;if(i="last-focused"===l[o].enterTo?B(o)||k(o)||L(o)[0]:k(o)||B(o)||L(o)[0])return O(i,o)}return!1},N=function(e,t){if("@"===e.charAt(0)){if(1===e.length)return j();var n=e.substr(1);return j(n)}var o=g(e),i=r(o,1)[0];if(i){var u=F(i);if(S(i,u))return O(i,u,t)}return!1},P=function(e,t){return T(e,"navigatefailed",{direction:t},!1)},M=function(e,t){if(l[e].leaveFor&&void 0!==l[e].leaveFor[t]){var n=l[e].leaveFor[t];if("string"==typeof n)return""===n?null:N(n,t);var r=F(n);if(S(n,r))return O(n,r,t)}return!1},C=function(e,t,n){var r=t.getAttribute("data-sn-"+e);if("string"==typeof r)return!(""===r||!N(r,e))||(P(t,e),!1);var o={},u=[];for(var c in l)o[c]=L(c),u=u.concat(o[c]);var s=I({},i,l[n]),f=void 0,d=void 0;if("self-only"===s.restrict||"self-first"===s.restrict){var v=o[n];d=x(v,t),(f=m(t,e,d,s))||"self-first"!==s.restrict||(d=x(u,v),f=m(t,e,d,s))}else d=x(u,t),f=m(t,e,d,s);if(f){l[n].previous={target:t,destination:f,reverse:a[e]};var h=F(f);if(n!==h){var y=M(n,e);if(y)return!0;if(null===y)return P(t,e),!1;var p=void 0;switch(l[h].enterTo){case"last-focused":p=B(h)||k(h);break;case"default-element":p=k(h)}p&&(f=p)}return O(f,h,e)}return!!M(n,e)||(P(t,e),!1)},K=function(e){return e.preventDefault(),e.stopPropagation(),!1},D=function(e){var t=e.target;if(t&&(t.classList.contains("focusable")||t.closest(".focusable"))){var n=t.classList.contains("focusable")?t:t.closest(".focusable");return O(n,F(n)),K(e)}},q=function(e){var t=e.target;if(t&&(t.classList.contains("focusable")||t.closest(".focusable"))){var n=t.classList.contains("focusable")?t:t.closest(".focusable");return T(n,"enter-down")?void 0:K(e)}},V=function(e){if(!(!d||f||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var t=E(),n=F(t),r=u[e.keyCode];if(r){if("enter"===r&&t&&n&&!T(t,"enter-down"))return K(e);if(!t&&(h&&(t=B(h)),!t))return j(),K(e);if(n)return T(t,"willmove",{direction:r,sectionId:n,cause:"keydown"})&&C(r,t,n),K(e)}}},_=function(e){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)&&!f&&d&&"center"===u[e.keyCode]){var t=E();t&&F(t)&&(T(t,"enter-up")||K(e))}},z=function(e){var t=e.target;if(t!==window&&t!==document&&d&&!y){var n=F(t);if(n){if(f)return void A(t,n);var r={sectionId:n,native:!0};T(t,"willfocus",r)?(T(t,"focused",r,!1),A(t,n)):(y=!0,t.blur(),y=!1)}}},H=function(e){var t=e.target;if(t!==window&&t!==document&&!f&&d&&!y&&F(t)){var n={native:!0};T(t,"willunfocus",n)?T(t,"unfocused",n,!1):(y=!0,setTimeout(function(){t.focus(),y=!1}))}},Y={init:function(){s||(window.addEventListener("mouseover",D),window.addEventListener("mousedown",q),window.addEventListener("keydown",V),window.addEventListener("keyup",_),window.addEventListener("focus",z,!0),window.addEventListener("blur",H,!0),s=!0)},uninit:function(){window.removeEventListener("mouseover",D),window.removeEventListener("mousedown",q),window.removeEventListener("blur",H,!0),window.removeEventListener("focus",z,!0),window.removeEventListener("keyup",_),window.removeEventListener("keydown",V),Y.clear(),c=0,s=!1},clear:function(){l={},d=0,v="",h="",y=!1},set:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0,u=void 0;if("object"===o(t[0]))u=t[0];else{if("string"!=typeof t[0]||"object"!==o(t[1]))return;if(r=t[0],u=t[1],!l[r])throw new Error("Section "+r+" doesn't exist!")}for(var a in u)void 0!==i[a]&&(r?l[r][a]=u[a]:void 0!==u[a]&&(i[a]=u[a]))},add:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0,i=void 0;if("object"===o(t[0])?i=t[0]:"string"==typeof t[0]&&"object"===o(t[1])&&(r=t[0],i=t[1]),r||(r="string"==typeof i.id?i.id:function(){var e=void 0;do{e="section-"+String(++c)}while(l[e]);return e}()),l[r])throw new Error("Section "+r+" has already existed!");return l[r]={},d++,Y.set(r,i),r},remove:function(e){if(!e||"string"!=typeof e)throw new Error('Please assign the "sectionId"!');return!!l[e]&&(l[e]=void 0,l=I({},l),d--,!0)},disable:function(e){return!!l[e]&&(l[e].disabled=!0,!0)},enable:function(e){return!!l[e]&&(l[e].disabled=!1,!0)},pause:function(){f=!0},resume:function(){f=!1},focus:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=t[1];"boolean"==typeof r&&void 0===o&&(o=r,r=void 0);var i=!f&&o;i&&Y.pause();var u=void 0;if(r)if("string"==typeof r)u=l[r]?j(r):N(r);else{var a=F(r);S(r,a)&&(u=O(r,a))}else u=j();return i&&Y.resume(),u},move:function(e,t){var n=e.toLowerCase();if(!a[n])return!1;var r=t?g(t)[0]:E();if(!r)return!1;var o=F(r);return!!o&&(!!T(r,"willmove",{direction:n,sectionId:o,cause:"api"})&&C(n,r,o))},makeFocusable:function(e){var t=function(e){var t=e.tabIndexIgnoreList||i.tabIndexIgnoreList;g(e.selector).forEach(function(e){w(e,t)||e.getAttribute("tabindex")||e.setAttribute("tabindex","-1")})};if(e){if(!l[e])throw new Error("Section "+e+" doesn't exist!");t(l[e])}else for(var n in l)t(l[n])},setDefaultSection:function(e){if(e){if(!l[e])throw new Error("Section "+e+" doesn't exist!");v=e}else v=""},getSectionId:F};var G=new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init=function(){Y.init(),Y.focus(),t.bindFocusEvent()},this.destroy=function(){t.focusedPath=null,Y.uninit(),t.unbindFocusEvent()},this.bindFocusEvent=function(){t.listening||(t.listening=!0,document.addEventListener("sn:focused",t.handleFocused))},this.unbindFocusEvent=function(){document.removeEventListener("sn:focused",t.handleFocused),t.listening=!1},this.handleFocused=function(e){t.focusedPath!==e.detail.sectionId&&t.setCurrentFocusedPath(e.detail.sectionId)},this.getCurrentFocusedPath=function(){return t.focusedPath},this.setCurrentFocusedPath=function(e){t.focusedPath=e,Y.focus(e)},this.addEventListener=function(e,n,r){return document.querySelectorAll(e).forEach(function(e){return e.addEventListener(n,r)}),t},this.addFocusable=function(e,n){if(e&&!Y.getSectionId(document.getElementById(e.id))){t.removeFocusable(e);var r=Y.add(e);n&&t.addEventListener(e.selector,"sn:enter-down",n),Y.makeFocusable(r)}},this.removeFocusable=function(e){var t=Y.getSectionId(document.getElementById(e.id));t&&(Y.remove(t),document.querySelectorAll(e.selector).removeEventListener("sn:enter-down"))},this.destroy()};e.TVNavigation=G,Object.defineProperty(e,"__esModule",{value:!0})});
