!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.TVNavigation={})}(this,function(e){"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t(e,[{key:"chebyshevDistance",value:function(e,t,n,r,o){var i=-r,u=void 0;for(u=0;u<n;u+=1)i=o(i,Math.abs(e[u]-t[u]));return i}},{key:"minkowskiDistance",value:function(e,t,n,r,o){var i=void 0,u=void 0;if(t!==r)throw new Error("Both vectors should have same dimension");if(isNaN(o))throw new Error('The order "p" must be a number');if(o===Number.POSITIVE_INFINITY)return this.chebyshevDistance(e,n,t,o,Math.max);if(o===Number.NEGATIVE_INFINITY)return this.chebyshevDistance(e,n,t,o,Math.min);if(o<1)throw new Error("Order less than 1 will violate the triangle inequality");for(i=0,u=0;u<t;u+=1)i+=Math.pow(Math.abs(e[u]-n[u]),o);return isNaN(i)?0:Math.pow(i,1/o)}},{key:"calculate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return this.minkowskiDistance(e,e.length,t,t.length,n)}}]),e}()),r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i={selector:"",straightOnly:!1,straightOverlapThreshold:.35,rememberSource:!1,disabled:!1,defaultElement:"",enterTo:"",leaveFor:null,restrict:"self-first",tabIndexIgnoreList:[],navigableFilter:null},u={4:"left",21:"left",37:"left",214:"left",205:"left",218:"left",5:"right",22:"right",39:"right",213:"right",206:"right",217:"right",29460:"up",19:"up",38:"up",211:"up",203:"up",215:"up",29461:"down",20:"down",40:"down",212:"down",204:"down",216:"down",29443:"enter",13:"enter",67:"enter",32:"enter",23:"enter",195:"enter"},a={left:"right",up:"down",right:"left",down:"up"},c=0,f=!1,s=!1,l={},d=0,v="",h="",p=!1,y=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(e){var t=(this.parentNode||this.document).querySelectorAll(e);return[].slice.call(t).indexOf(this)>=0},g=function(e){var t=e.getBoundingClientRect(),n={left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height};return n.element=e,n.center={x:n.left+Math.floor(n.width/2),y:n.top+Math.floor(n.height/2)},n.center.left=n.center.x,n.center.right=n.center.x,n.center.top=n.center.y,n.center.bottom=n.center.y,n},m=function(e,t,r,o){if(!(e&&t&&r&&r.length))return null;var i=g(e);if(!i)return null;var u=void 0;if(r.forEach(function(e){var t=g(e);t&&u.push(t)}),!u.length)return null;var a=i.center,c=a.targetX,f=a.targetY;u.sort(function(e,t){return n.calculate([c,f],[e.center.x,e.center.y])>n.calculate([c,f],[t.center.x,t.center.y])?1:-1});var s=function(e){return{nearPlumbLineIsBetter:function(t){var n=void 0;return(n=t.center.x<e.center.x?e.center.x-t.right:t.left-e.center.x)<0?0:n},nearHorizonIsBetter:function(t){var n=void 0;return(n=t.center.y<e.center.y?e.center.y-t.bottom:t.top-e.center.y)<0?0:n},nearTargetLeftIsBetter:function(t){var n=void 0;return(n=t.center.x<e.center.x?e.left-t.right:t.left-e.left)<0?0:n},nearTargetTopIsBetter:function(t){var n=void 0;return(n=t.center.y<e.center.y?e.top-t.bottom:t.top-e.top)<0?0:n},topIsBetter:function(e){return e.top},bottomIsBetter:function(e){return-1*e.bottom},leftIsBetter:function(e){return e.left},rightIsBetter:function(e){return-1*e.right}}}(i),l=void 0;switch(t){case"left":l=[{group:u=u.filter(function(e){return e.center.x<i.center.x}),distance:[s.nearPlumbLineIsBetter,s.topIsBetter]},{group:u,distance:[s.nearHorizonIsBetter,s.rightIsBetter,s.nearTargetTopIsBetter]}];break;case"right":l=[{group:u=u.filter(function(e){return e.center.x>i.center.x}),distance:[s.nearPlumbLineIsBetter,s.topIsBetter]},{group:u,distance:[s.nearHorizonIsBetter,s.leftIsBetter,s.nearTargetTopIsBetter]}];break;case"up":l=[{group:u=u.filter(function(e){return e.center.y<i.center.y}),distance:[s.nearHorizonIsBetter,s.leftIsBetter]},{group:u,distance:[s.nearPlumbLineIsBetter,s.bottomIsBetter,s.nearTargetLeftIsBetter]}];break;case"down":l=[{group:u=u.filter(function(e){return e.center.y>i.center.y}),distance:[s.nearPlumbLineIsBetter,s.topIsBetter,s.nearTargetLeftIsBetter]}];break;default:return null}o.straightOnly&&l.pop();var d=function(e){var t=void 0;for(var n in e)if(n.group.length){t=n;break}return t?(t.group.sort(function(e,n){return t.distance.forEach(function(t){var r=t(e)-t(n);if(r)return r}),0}),t.group):null}(l);if(!d)return null;var v=void 0;if(o.rememberSource&&o.previous&&o.previous.destination===e&&o.previous.reverse===t)for(var h in d)if(h.element===o.previous.target){v=h.element;break}return v||(v=d[0].element),v},b=function(e){return"string"==typeof e?[].slice.call(document.querySelectorAll(e)):"object"===(void 0===e?"undefined":o(e))&&e.length?[].slice.call(e):"object"===(void 0===e?"undefined":o(e))&&1===e.nodeType?[e]:[]},w=function(e,t){return"string"==typeof t?y.call(e,t):"object"===(void 0===t?"undefined":o(t))&&t.length?t.indexOf(e)>=0:"object"===(void 0===t?"undefined":o(t))&&1===t.nodeType&&e===t},E=function(){var e=document.activeElement;if(e&&e!==document.body)return e},I=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var o=e||{},i=1;i<n.length;i++)if(n[i])for(var u in n[i])Object.prototype.hasOwnProperty.call(n[i],u)&&void 0!==n[i][u]&&(o[u]=n[i][u]);return o},x=function(e,t){for(var n in Array.from(t)){var r=e.indexOf(n);r>=0&&e.splice(r,1)}return e},B=function(e,t,n){if(!e||!t||!l[t]||l[t].disabled)return!1;if(e.offsetWidth<=0&&e.offsetHeight<=0||e.hasAttribute("disabled"))return!1;if(n&&!w(e,l[t].selector))return!1;if("function"==typeof l[t].navigableFilter){if(!1===l[t].navigableFilter(e,t))return!1}else if("function"==typeof i.navigableFilter&&!1===i.navigableFilter(e,t))return!1;return!0},k=function(e){for(var t in l)if(!l[t].disabled&&e&&w(e,l[t].selector))return t},F=function(e){b(l[e].selector).filter(function(t){return B(t,e)})},S=function(e){var t=l[e].defaultElement;if(!t)return null;if("string"==typeof t){var n=b(t);t=r(n,1)[0]}return B(t,e,!0)?t:null},L=function(e){var t=l[e]&&l[e].lastFocusedElement;return B(t,e,!0)?t:null},T=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=document.createEvent("CustomEvent");return o.initCustomEvent("sn:"+t,!0,r,n),e.dispatchEvent(o)},P=function(e,t){var n=t||k(e);n&&(l[n].lastFocusedElement=e,h=n)},A=function(e,t,n){if(!e)return!1;var r=E(),o=function(){r&&r.blur(),e.focus(),P(e,t)};if(p)return o(),!0;if(p=!0,s)return o(),p=!1,!0;if(r){var i={nextElement:e,nextSectionId:t,direction:n,native:!1};if(!T(r,"willunfocus",i))return p=!1,!1;r.blur(),T(r,"unfocused",i,!1)}var u={previousElement:r,sectionId:t,direction:n,native:!1};return T(e,"willfocus",u)?(e.focus(),T(e,"focused",u,!1),p=!1,P(e,t),!0):(p=!1,!1)},C=function(e){var t=[],n=function(e){e&&t.indexOf(e)<0&&l[e]&&!l[e].disabled&&t.push(e)};for(var r in e?n(e):(n(v),n(h),Object.keys(l).map(n)),t){var o=void 0;if(o="last-focused"===l[r].enterTo?L(r)||S(r)||F(r)[0]:S(r)||L(r)||F(r)[0])return A(o,r)}return!1},O=function(e,t){if("@"===e.charAt(0)){if(1===e.length)return C();var n=e.substr(1);return C(n)}var o=b(e),i=r(o,1)[0];if(i){var u=k(i);if(B(i,u))return A(i,u,t)}return!1},j=function(e,t){return T(e,"navigatefailed",{direction:t},!1)},N=function(e,t){if(l[e].leaveFor&&void 0!==l[e].leaveFor[t]){var n=l[e].leaveFor[t];if("string"==typeof n)return""===n?null:O(n,t);var r=k(n);if(B(n,r))return A(n,r,t)}return!1},M=function(e,t,n){var r=t.getAttribute("data-sn-"+e);if("string"==typeof r)return!(""===r||!O(r,e))||(j(t,e),!1);var o={},u=[];for(var c in l)o[c]=F(c),u=u.concat(o[c]);var f=I({},i,l[n]),s=void 0,d=void 0;if("self-only"===f.restrict||"self-first"===f.restrict){var v=o[n];d=x(v,t),(s=m(t,e,d,f))||"self-first"!==f.restrict||(d=x(u,v),s=m(t,e,d,f))}else d=x(u,t),s=m(t,e,d,f);if(s){l[n].previous={target:t,destination:s,reverse:a[e]};var h=k(s);if(n!==h){var p=N(n,e);if(p)return!0;if(null===p)return j(t,e),!1;var y=void 0;switch(l[h].enterTo){case"last-focused":y=L(h)||S(h);break;case"default-element":y=S(h)}y&&(s=y)}return A(s,h,e)}return!!N(n,e)||(j(t,e),!1)},K=function(e){if(console.log(">>>> onKeyDown ",u[e.keyCode]),!(!d||s||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var t=function(){return e.preventDefault(),e.stopPropagation(),!1},n=E(),r=k(n),o=u[e.keyCode];if(o){if("enter"===o&&n&&r&&!T(n,"enter-down"))return t();if(!n&&(h&&(n=L(h)),!n))return C(),t();if(r)return T(n,"willmove",{direction:o,sectionId:r,cause:"keydown"})&&M(o,n,r),t()}}},D=function(e){if(console.log(">>>> onKeyUp ",u[e.keyCode]),!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)&&!s&&d&&"center"===u[e.keyCode]){var t=E();t&&k(t)&&(T(t,"enter-up")||(e.preventDefault(),e.stopPropagation()))}},q=function(e){console.log(">>>> onFocus ",u[e.keyCode]);var t=e.target;if(t!==window&&t!==document&&d&&!p){var n=k(t);if(n){if(s)return void P(t,n);var r={sectionId:n,native:!0};T(t,"willfocus",r)?(T(t,"focused",r,!1),P(t,n)):(p=!0,t.blur(),p=!1)}}},z=function(e){console.log(">>>> onBlur ",u[e.keyCode]);var t=e.target;if(t!==window&&t!==document&&!s&&d&&!p&&k(t)){var n={native:!0};T(t,"willunfocus",n)?T(t,"unfocused",n,!1):(p=!0,setTimeout(function(){t.focus(),p=!1}))}},H={init:function(){f||(window.addEventListener("keydown",K),window.addEventListener("keyup",D),window.addEventListener("focus",q,!0),window.addEventListener("blur",z,!0),f=!0)},uninit:function(){window.removeEventListener("blur",z,!0),window.removeEventListener("focus",q,!0),window.removeEventListener("keyup",D),window.removeEventListener("keydown",K),H.clear(),c=0,f=!1},clear:function(){l={},d=0,v="",h="",p=!1},set:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0,u=void 0;if("object"===o(t[0]))u=t[0];else{if("string"!=typeof t[0]||"object"!==o(t[1]))return;if(r=t[0],u=t[1],!l[r])throw new Error("Section "+r+" doesn't exist!")}for(var a in u)void 0!==i[a]&&(r?l[r][a]=u[a]:void 0!==u[a]&&(i[a]=u[a]));r&&(l[r]=I({},l[r]))},add:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=void 0,i=void 0;if("object"===o(t[0])?i=t[0]:"string"==typeof t[0]&&"object"===o(t[1])&&(r=t[0],i=t[1]),r||(r="string"==typeof i.id?i.id:function(){var e=void 0;do{e="section-"+String(++c)}while(l[e]);return e}()),l[r])throw new Error("Section "+r+" has already existed!");return l[r]={},d++,H.set(r,i),r},remove:function(e){if(!e||"string"!=typeof e)throw new Error('Please assign the "sectionId"!');return!!l[e]&&(l[e]=void 0,l=I({},l),d--,!0)},disable:function(e){return!!l[e]&&(l[e].disabled=!0,!0)},enable:function(e){return!!l[e]&&(l[e].disabled=!1,!0)},pause:function(){s=!0},resume:function(){s=!1},focus:function(e,t){void 0===t&&"boolean"==typeof e&&(t=e,e=void 0);var n=!s&&t;n&&H.pause();var r=void 0;if(e)if("string"==typeof e)r=l[e]?C(e):O(e);else{var o=k(e);B(e,o)&&(r=A(e,o))}else r=C();return n&&H.resume(),r},move:function(e,t){var n=e.toLowerCase();if(!a[n])return!1;var r=t?b(t)[0]:E();if(!r)return!1;var o=k(r);return!!o&&(!!T(r,"willmove",{direction:n,sectionId:o,cause:"api"})&&M(n,r,o))},makeFocusable:function(e){var t=function(e){var t=e.tabIndexIgnoreList||i.tabIndexIgnoreList;b(e.selector).forEach(function(e){w(e,t)||e.getAttribute("tabindex")||e.setAttribute("tabindex","-1")})};if(e){if(!l[e])throw new Error("Section "+e+" doesn't exist!");t(l[e])}else for(var n in l)t(l[n])},setDefaultSection:function(e){if(e){if(!l[e])throw new Error("Section "+e+" doesn't exist!");v=e}else v=""},getSectionId:k};var V=new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init=function(){H.init(),H.focus(),t.bindFocusEvent()},this.destroy=function(){t.focusedPath=null,H.uninit(),t.unbindFocusEvent()},this.bindFocusEvent=function(){t.listening||(t.listening=!0,document.addEventListener("sn:focused",t.handleFocused))},this.unbindFocusEvent=function(){document.removeEventListener("sn:focused",t.handleFocused),t.listening=!1},this.handleFocused=function(e){t.focusedPath!==e.detail.sectionId&&t.setCurrentFocusedPath(e.detail.sectionId)},this.getCurrentFocusedPath=function(){return t.focusedPath},this.setCurrentFocusedPath=function(e){t.focusedPath=e,H.focus(e)},this.addEventListener=function(e,n,r){return document.querySelectorAll(e).forEach(function(e){return e.addEventListener(n,r)}),t},this.addFocusable=function(e,n){if(e&&!H.getSectionId(document.getElementById(e.id))){t.removeFocusable(e);var r=H.add(e);n&&t.addEventListener(e.selector,"sn:enter-down",n),H.makeFocusable(r)}},this.removeFocusable=function(e){var t=H.getSectionId(document.getElementById(e.id));t&&(H.remove(t),document.querySelectorAll(e.selector).removeEventListener("sn:enter-down"))},this.destroy()};e.TVNavigation=V,Object.defineProperty(e,"__esModule",{value:!0})});
